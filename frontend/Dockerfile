FROM node:18-alpine

WORKDIR /app

# ë¹Œë“œ ì‹œ í™˜ê²½ë³€ìˆ˜ ë°›ê¸° (ì¤‘ìš”!)
ARG REACT_APP_API_URL
ENV REACT_APP_API_URL=$REACT_APP_API_URL

# package.json ë° lock íŒŒì¼ ë³µì‚¬
COPY package*.json ./

# npm ì„¤ì • ë° ìºì‹œ í´ë¦¬ì–´
# npm installì„ ì‹œë„í•˜ê¸° ì „ì— ì„¤ì •ì„ ë¨¼ì € ì ìš©í•©ë‹ˆë‹¤.
RUN npm config set fetch-retry-maxtimeout 120000 && \
    npm config set fetch-retry-mintimeout 20000 && \
    npm cache clean --force

# ğŸš€ ëª¨ë“  ì¢…ì†ì„± ë° ëª…ì‹œì  íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë¸”ë¡ í†µí•© ğŸš€
# 1. package.jsonì— ì •ì˜ëœ ê¸°ë³¸ íŒ¨í‚¤ì§€ ì„¤ì¹˜
# 2. ëˆ„ë½ë˜ì—ˆê±°ë‚˜ ëª…ì‹œì ìœ¼ë¡œ í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤ì„ ëª¨ë‘ í•œ ì¤„ì— ì„¤ì¹˜
RUN npm install --loglevel verbose && \
    npm install \
    @hello-pangea/dnd@^18.0.1 \
    framer-motion@^12.23.24 \
    react-icons@^4.12.0 \
    react-calendar@^4.6.1 \
    @mui/material@^5.15.13 \
    @mui/icons-material@^5.15.13 \
    @emotion/react@^11.11.4 \
    @emotion/styled@^11.11.0 \
    lucide-react@^0.548.0

# ì„¤ì¹˜ í™•ì¸ (ì´ ë¶€ë¶„ì€ ë””ë²„ê¹…ìš©ìœ¼ë¡œ ìœ ì§€)
RUN echo "=== Checking installed packages ===" && \
    ls -la node_modules/framer-motion && \
    ls -la node_modules/react-icons && \
    ls -la node_modules/react-calendar && \
    ls -la node_modules/@mui/icons-material && \
    ls -la node_modules/@emotion

COPY . .

EXPOSE 3000

CMD ["npm", "start"]